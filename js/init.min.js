var url_base=document.getElementById("initjs").src.split("?")[1];$(document).ready(function(){$("#side-bar > ul").metisMenu({toggle:!1}),$("#side-bar li>a").each(function(b,c){length=c.href.length,window.location.href.substr(0,length)==c.href&&(ul=$(c.parentNode.parentNode.parentNode).children(),ul[0].setAttribute("aria-expanded","true"),li=$(c.parentNode.parentNode.parentNode),li[0].className="active",c.parentNode.parentNode.className="collapse in",c.parentNode.parentNode.setAttribute("aria-expanded","true"))}),$(".btn-side-bar>a").click(function(){$(".side-bar").hasClass("click")?$("#side-bar").removeClass("click"):$("#side-bar").addClass("click")}),$(".selectpicker").selectpicker(),$("[data-toggle=\"tooltip\"]").tooltip(),x=0,$("#ordered").click(function(){x?($("#side-bar ul").sortable("disable"),x=0):($("#side-bar ul").sortable({revert:!0,opacity:0.6,cursor:"move",update:function(){for(li=this.getElementsByTagName("li"),a=li[0].childNodes,$.post(url_base+"service/delete_ordered",{event:""}),i=0;i<li.length;i++)a=li[i].childNodes,$.post(url_base+"service/ordered",{idservice:a[0].id,ordered:i+1})}}),x=1)}),$("i.glyphicon-minus").each(function(){$(this).click(function(){div=this.parentNode.parentNode.parentNode.getElementsByClassName("box-container"),$(div[0]).fadeToggle()})}),$(".box").css("opacity","1"),$(".datepickerx").datepicker({format:"dd-mm-yyyy",language:"es",minDate:new Date})}),tinymce.init({selector:".tinymce",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern imagetools codesample toc"],language:"es",toolbar1:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent ",toolbar2:"print preview media | forecolor backcolor emoticons | imageplus code",height:"350",toolbar_items_size:"small",file_browser_callback:function(b,c,e,f){f.document.getElementById(b).value="my browser value"},relative_urls:!1,convert_urls:!0,setup:function(b){b.addButton("imageplus",{type:"button",title:"Insert image",icon:"image",id:"imageplus",onclick:function(){b.focus(),show_gallery_modal(1)}})}});function show_gallery_modal(b,c){$.post(url_base+"gallery/show_ajax",{event:"ajax"},function(e){d=JSON.parse(e),img="<ul class='gallery'>";for(var f=0;f<d.length;f++)img+=0==b?"<li><a onclick='selected_two(this,\""+c.id+"\");'><img id='"+d[f].idgallery+"' src='"+url_base+d[f].src+"' title='"+d[f].name+"'></a></li>":"<li><a onclick='selected(this);'><img id='"+d[f].idgallery+"' src='"+url_base+d[f].src+"' title='"+d[f].name+"'></a></li>";img+="</ul>",$("#gallery_modal .modal-body").html(img)}),$("#gallery_modal").modal("show"),$(".progressbar").css("width","0"),$(".progressbar").html(""),$("#image").val(""),$("#image").attr("onchange","upload('"+b+"','"+c.id+"');")}function upload(b,c){var e=new FormData($("#formuploadajax")[0]);$.ajax({url:url_base+"gallery/upload",type:"POST",data:e,contentType:!1,processData:!1,xhr:function(){var g=new window.XMLHttpRequest;return g.upload.addEventListener("progress",function(h){if(h.lengthComputable){var j=h.loaded/h.total;j=parseInt(100*j),$(".progressbar").css("width",j+"%"),$(".progressbar").html(j+"%")}},!1),g},success:function(g){"1"==b?$(".gallery").prepend("<li><a onclick='selected(this);'>"+g+"</a></li>"):"2"==b?$(".gallery").prepend("<li><a onclick='show_img(this);'>"+g+"</a></li>"):$(".gallery").prepend("<li><a onclick='selected_two(this,\""+c+"\");'>"+g+"</a></li>")}})}function selected(b){img=b.getElementsByTagName("img"),$(".gallery_selected").attr("class",""),img[0].className+="gallery_selected",tinymce.activeEditor.execCommand("mceInsertContent",!1,"<img src='"+img[0].src+"'>")}function selected_two(b,c){img=b.getElementsByTagName("img"),$(".gallery_selected").attr("class",""),img[0].className+="gallery_selected",document.getElementById(c).src=img[0].src,document.getElementById("idgallery_"+c).value=img[0].id}function show_img(b){var c=b.getElementsByTagName("img")[0].src.replace(url_base,"");$("#gallery_modal").modal("show"),$.post(url_base+"gallery/query/",{src:c},function(e){var f=$.parseJSON(e);$("#form_modal").attr("action",url_base+"gallery/edit/"+f.idgallery),$("#image_preview").attr("src",f.src),$("#image_preview").attr("alt",f.alternative),$("#src").val(url_base+f.src),$("#title").val(f.title),$("#legend").val(f.legend),$("#alternative").val(f.alternative),$("#description").val(f.description),$("#created").html("<b>"+aajs_language.gallery_created_by+": </b> "+f.person+" "+f.date_created),$("#img_delete").attr("href",url_base+"gallery/delete/"+f.idgallery)})}