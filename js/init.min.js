var url_base=document.getElementById("initjs").src.split("?")[1];function show_gallery_modal(e,a){$.post(url_base+"gallery/show_ajax",{event:"ajax"},function(t){d=JSON.parse(t),img="<ul class='gallery'>";for(var l=0;l<d.length;l++)img+=0==e?"<li><a onclick='selected_two(this,\""+a.id+"\");'><img id='"+d[l].idgallery+"' src='"+url_base+d[l].src+"' title='"+d[l].name+"'></a></li>":"<li><a onclick='selected(this);'><img id='"+d[l].idgallery+"' src='"+url_base+d[l].src+"' title='"+d[l].name+"'></a></li>";img+="</ul>",$("#gallery_modal .modal-body").html(img)}),$("#gallery_modal").modal("show"),$(".progressbar").css("width","0"),$(".progressbar").html(""),$("#image").val(""),$("#image").attr("onchange","upload('"+e+"','"+a.id+"');")}function upload(e,a){var t=new FormData($("#formuploadajax")[0]),l=url_base+"gallery/upload";$.ajax({url:l,type:"POST",data:t,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.loaded/e.total;a=parseInt(100*a),$(".progressbar").css("width",a+"%"),$(".progressbar").html(a+"%")}},!1),e},success:function(t){"1"==e?$(".gallery").prepend("<li><a onclick='selected(this);'>"+t+"</a></li>"):"2"==e?$(".gallery").prepend("<li><a onclick='show_img(this);'>"+t+"</a></li>"):$(".gallery").prepend("<li><a onclick='selected_two(this,\""+a+"\");'>"+t+"</a></li>")}})}function selected(e){img=e.getElementsByTagName("img"),$(".gallery_selected").attr("class",""),img[0].className+="gallery_selected",tinymce.activeEditor.execCommand("mceInsertContent",!1,"<img src='"+img[0].src+"'>")}function selected_two(e,a){img=e.getElementsByTagName("img"),$(".gallery_selected").attr("class",""),img[0].className+="gallery_selected",document.getElementById(a).src=img[0].src,document.getElementById("idgallery_"+a).value=img[0].id}function show_img(e){var a=e.getElementsByTagName("img")[0].src.replace(url_base,"");$("#gallery_modal").modal("show"),$.post(url_base+"gallery/query",{src:a},function(e){var a=$.parseJSON(e);$("#form_modal").attr("action",url_base+"gallery/edit/"+a.idgallery),$("#image_preview").attr("src",a.src),$("#image_preview").attr("alt",a.alternative),$("#src").val(url_base+a.src),$("#title").val(a.title),$("#legend").val(a.legend),$("#alternative").val(a.alternative),$("#description").val(a.description),$("#created").html("<b>"+aajs_language.gallery_created_by+": </b> "+a.person+" "+a.date_created),$("#img_delete").attr("href",url_base+"gallery/delete/"+a.idgallery)})}$(document).ready(function(){$("#datatable").dataTable({language:{url:url_base+"third_party/datatables/language/es.json"},order:[[0,"desc"]]}),$("#side-bar > ul").metisMenu({toggle:!1}),$("#side-bar li>a").each(function(e,a){window.location.href.substr(0,a.href.length)==a.href&&(ulcero=$(a.parentNode.parentNode.parentNode),ulcero[0].className="active",a.parentNode.parentNode.parentNode.parentNode.className="collapse in",a.parentNode.parentNode.className="collapse in",a.parentNode.parentNode.setAttribute("aria-expanded","true"))}),$(".btn-side-bar>a").click(function(){$(".side-bar").hasClass("click")?$("#side-bar").removeClass("click"):$("#side-bar").addClass("click")}),$(".selectpicker").selectpicker(),$('[data-toggle="tooltip"]').tooltip(),x=0,$("#ordered").click(function(){x?($("#side-bar ul").sortable("disable"),x=0):($("#side-bar ul").sortable({revert:!0,opacity:.6,cursor:"move",update:function(){$.post(url_base+"service/delete-ordered",{event:""}),$("#side-bar ul > li").each(function(e,a){$.post(url_base+"service/ordered",{idservice:a.childNodes[0].id,ordered:e+1})})}}),x=1)}),$("i.glyphicon-minus").each(function(e,a){$(this).click(function(){div=this.parentNode.parentNode.parentNode.getElementsByClassName("box-container"),$(div[0]).fadeToggle()})}),$(".box").css("opacity","1"),$(".datepickerx").datepicker({format:"dd-mm-yyyy",language:"es",minDate:new Date})}),tinymce.init({selector:".tinymce",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern imagetools codesample toc"],language:"es",toolbar1:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent ",toolbar2:"print preview media | forecolor backcolor emoticons | imageplus code",height:"350",toolbar_items_size:"small",file_browser_callback:function(e,a,t,l){l.document.getElementById(e).value="my browser value"},relative_urls:!1,convert_urls:!0,setup:function(e){e.addButton("imageplus",{type:"button",title:"Insert image",icon:"image",id:"imageplus",onclick:function(){e.focus(),show_gallery_modal(1)}})}});